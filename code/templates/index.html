<html>
<head>
<title>OpenVNAVI Controller</title>
<script type=text/javascript src="{{url_for('static', filename='jquery-1.11.3.min.js') }}"></script>
</head>

<body>
<script type=text/javascript>
  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>

<h2>Vibration motor values</h2>

<div>
    Input mode:
    <input type="radio" name="inputMode" value="kinect">Kinect</td>
    <input type="radio" name="inputMode" value="web">Web</td>
</div>

<div id="motorsContainer"></div>
<button id="sendButton">Send</button>

<div>
    Set all: <input id="setAllInput" type="text" size = "3"/>
    <button id="setAllButton">Set</button>
</div>

<script type=text/javascript>
  $(function() {
    // global parameters
    var rowCount = 8
    var colCount = 16


    // create text boxes for motor input
    var inputContainer = $('div#motorsContainer');
    var motorInputs = [];

    for (var row = 0; row < rowCount; row++)
    {
        for (var col = 0; col < colCount; col++)
        {
            var aMotorInput = $("<input type='text' size = '3' value='0'/>");
            motorInputs.push(aMotorInput);
            inputContainer.append(aMotorInput);
        }
        inputContainer.append($("<br/>"));
    }

    // listen to submit button event
    $('#sendButton').bind('click', function() {
        var motorValues = [];
        for (var row = 0; row < rowCount; row++)
        {
            rowValues = []
            for (var col = 0; col < colCount; col++)
            {
                var index = row * colCount + col;
                var motorValue = parseInt(motorInputs[index].val());
                rowValues.push(motorValue);
            }
            motorValues.push(rowValues)
        }

        var modeValue = $("input[name=inputMode]:checked").val();

        // handler for server response
        var responseHanlder = function(data) 
        {
            console.log(data);
        }
        
        // data to be sent to the server
        var data = {
            "motors": motorValues,
            "mode": modeValue
        }

        // sending data to server
        $.ajax({
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(data),
            dataType: 'json',
            url: $SCRIPT_ROOT + '/_send_motors',
            success: responseHanlder
        });
    

        // end bind()
        return false;
    
    });

    $('#setAllButton').bind('click', function() {
        var inputValue = $("#setAllInput").val();
        $.each(motorInputs, function(index, motorInput) {
            motorInput.val(inputValue);
        });

        // end bind()
        return false;
    });

  });
</script>

</body>

</html>